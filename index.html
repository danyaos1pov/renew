<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SPYFALL MEGA PACK</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>

    <style>
        :root {
            --accent: #00f2ff;
            --bg: #0a0e14;
            --card-dark: #151a21;
            --glass: rgba(255, 255, 255, 0.05);
            --danger: #ff4d4d;
            --success: #00ff88;
        }

        * { 
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent; 
            font-family: 'Montserrat', sans-serif;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg);
            color: white;
            height: 100dvh; width: 100%;
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        .bg-glow {
            position: absolute;
            width: 250px; height: 250px;
            background: var(--accent); filter: blur(120px);
            opacity: 0.1; z-index: -1; top: 10%; left: 50%;
            transform: translate(-50%, -50%);
        }

        .wrapper {
            flex: 1; display: flex; flex-direction: column;
            max-width: 650px; margin: 0 auto; width: 100%; height: 100%;
            padding: max(15px, env(safe-area-inset-top)) max(15px, env(safe-area-inset-right)) max(15px, env(safe-area-inset-bottom)) max(15px, env(safe-area-inset-left));
        }

        .screen { display: none; flex-direction: column; height: 100%; animation: fadeIn 0.2s ease-out; }
        .screen.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        h1 { font-weight: 900; font-size: 2.2rem; margin: 0; text-align: center; letter-spacing: -1px; }
        .tagline { color: var(--accent); font-size: 0.65rem; text-align: center; letter-spacing: 3px; margin-bottom: 20px; }

        .setting-box {
            background: var(--glass);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px; padding: 14px; margin-bottom: 12px;
            display: flex; justify-content: space-between; align-items: center;
        }

        .controls-row { display: flex; align-items: center; gap: 15px; }
        .num-btn {
            background: #000; border: 1px solid var(--accent);
            color: var(--accent); width: 38px; height: 38px;
            border-radius: 12px; font-size: 1.4rem; font-weight: bold;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
        }
        .num-value { font-size: 1.2rem; font-weight: 900; min-width: 25px; text-align: center; }

        .btn {
            background: white; color: black; border: none; padding: 18px;
            border-radius: 16px; font-weight: 900; text-transform: uppercase;
            font-size: 0.9rem; cursor: pointer; transition: 0.2s; width: 100%;
        }
        .btn:active { transform: scale(0.96); filter: brightness(0.9); }
        .btn-neon { background: var(--accent); box-shadow: 0 4px 15px rgba(0, 242, 255, 0.2); }
        .btn-outline { background: transparent; color: white; border: 1px solid rgba(255,255,255,0.2); margin-top: 10px; }
        .btn-danger-outline { background: transparent; color: var(--danger); border: 1px solid rgba(255, 77, 77, 0.3); margin-top: 10px; padding: 12px; }

        .card-area { flex: 0 0 280px; perspective: 1000px; margin: 15px 0; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; }
        .card-inner.flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 24px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; border: 1px solid rgba(255,255,255,0.1); }
        .card-front { background: var(--card-dark); }
        .card-back { background: white; color: black; transform: rotateY(180deg); text-align: center; }

        #timer { font-size: 4.5rem; font-weight: 900; text-align: center; color: var(--accent); margin: auto 0; }

        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.97); z-index: 100; padding: 20px;
            flex-direction: column; justify-content: center; align-items: center;
            backdrop-filter: blur(15px);
        }
        .modal.active { display: flex; }
        .modal-content {
            width: 100%; max-width: 500px; background: #0f1218; border: 1px solid var(--accent);
            border-radius: 24px; display: flex; flex-direction: column; max-height: 85vh; overflow: hidden;
        }
        .modal-body { flex: 1; overflow-y: auto; padding: 20px; }
    </style>
</head>
<body oncontextmenu="return false;">

<div class="bg-glow"></div>

<div class="wrapper">
    <div id="setup" class="screen active">
        <h1>SPYFALL</h1>
        <div class="tagline">by DANGO</div>
        
        <div class="setting-box">
            <div><b>–ò–≥—Ä–æ–∫–æ–≤</b></div>
            <div class="controls-row">
                <div class="num-btn" onclick="adjust('p-count', -1)">-</div>
                <div id="p-count-val" class="num-value">4</div>
                <div class="num-btn" onclick="adjust('p-count', 1)">+</div>
            </div>
            <input type="hidden" id="p-count" value="4">
        </div>

        <div class="setting-box">
            <div><b>–¢–∞–π–º–µ—Ä (–º–∏–Ω)</b></div>
            <div class="controls-row">
                <div class="num-btn" onclick="adjust('t-count', -1)">-</div>
                <div id="t-count-val" class="num-value">5</div>
                <div class="num-btn" onclick="adjust('t-count', 1)">+</div>
            </div>
            <input type="hidden" id="t-count" value="5">
        </div>
        
        <div style="margin-top: auto; display: flex; flex-direction: column; gap: 10px;">
            <button class="btn btn-neon" onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            <button class="btn btn-outline" onclick="toggleModal('rules-modal', true)">–ö–∞–∫ –∏–≥—Ä–∞—Ç—å</button>
        </div>
    </div>

    <div id="roles" class="screen">
        <div id="player-indicator" style="text-align: center; font-weight: 900; color: var(--accent);">–ò–ì–†–û–ö 1</div>
        <div class="card-area">
            <div class="card-inner" id="card" onclick="flipCard()">
                <div class="card-face card-front">
                    <span style="font-size: 2.5rem;">üïµÔ∏è</span>
                    <p style="color: #666; font-size: 0.7rem; margin-top: 15px;">–ù–ê–ñ–ú–ò –î–õ–Ø –ü–†–û–°–ú–û–¢–†–ê</p>
                </div>
                <div class="card-face card-back">
                    <div id="role-status" style="font-size: 0.8rem; font-weight: bold;">–í–ê–®–ê –†–û–õ–¨:</div>
                    <div id="role-main" style="font-size: 1.5rem; font-weight: 900; margin-top: 10px; line-height: 1.1;">–õ–û–ö–ê–¶–ò–Ø</div>
                </div>
            </div>
        </div>
        <button class="btn btn-neon" id="next-btn" style="visibility: hidden; margin-top: auto;" onclick="nextPlayer()">–ü–†–ò–ù–Ø–¢–û</button>
    </div>

    <div id="game" class="screen">
        <div id="timer">00:00</div>
        <div style="margin-top: auto; display: flex; flex-direction: column; gap: 10px;">
            <button class="btn btn-neon" style="background: #1a1a1a; color: var(--accent); box-shadow: none;" onclick="toggleModal('q-modal', true)">–ò–¥–µ–∏ –≤–æ–ø—Ä–æ—Å–æ–≤</button>
            <button class="btn btn-danger-outline" onclick="confirmReset()">–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É</button>
        </div>
    </div>
</div>

<div class="modal" id="rules-modal">
    <div class="modal-content">
        <div class="modal-body" style="font-size: 0.9rem; line-height: 1.5;">
            <h2 style="margin-top: 0; color: var(--accent);">–ö–ê–ö –ò–ì–†–ê–¢–¨</h2>
            <p>1. <b>–†–æ–ª–∏:</b> –í—Å–µ –∑–Ω–∞—é—Ç –ª–æ–∫–∞—Ü–∏—é, –∫—Ä–æ–º–µ –®–ø–∏–æ–Ω–∞.</p>
            <p>2. <b>–¶–µ–ª—å:</b> –®–ø–∏–æ–Ω –¥–æ–ª–∂–µ–Ω —É–≥–∞–¥–∞—Ç—å –º–µ—Å—Ç–æ, –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî –Ω–∞–π—Ç–∏ —à–ø–∏–æ–Ω–∞.</p>
            <p>3. <b>–ü—Ä–æ—Ü–µ—Å—Å:</b> –ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã ("–¢–∞–º —Ç–µ–ø–ª–æ?", "–¢—ã —Ç–∞–º —Ä–∞–±–æ—Ç–∞–µ—à—å?").</p>
        </div>
        <div style="padding: 15px;"><button class="btn btn-neon" onclick="toggleModal('rules-modal', false)">–ü–û–ù–Ø–¢–ù–û</button></div>
    </div>
</div>

<div class="modal" id="q-modal">
    <div class="modal-content">
        <div class="modal-body" id="questions-list"></div>
        <div style="padding: 15px;"><button class="btn btn-neon" onclick="toggleModal('q-modal', false)">–ó–ê–ö–†–´–¢–¨</button></div>
    </div>
</div>

<div class="modal" id="confirm-modal">
    <div class="modal-content" style="text-align: center; padding: 25px;">
        <h2 style="margin-top: 0; color: var(--danger);">–í–´–•–û–î</h2>
        <p style="color: #ccc; margin-bottom: 25px;">–ü—Ä–µ—Ä–≤–∞—Ç—å –∏–≥—Ä—É –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é?</p>
        <div style="display: flex; gap: 10px;">
            <button class="btn" style="background: #333; color: white;" onclick="toggleModal('confirm-modal', false)">–û–¢–ú–ï–ù–ê</button>
            <button class="btn" style="background: var(--danger); color: white;" onclick="resetApp()">–î–ê</button>
        </div>
    </div>
</div>

<script>
    vkBridge.send("VKWebAppInit");

    const MY_LOCATIONS = ["–ü–ª—è–∂", "–õ–µ—Å", "–ö–∞—Ñ–µ", "–ó–æ–æ–ø–∞—Ä–∫", "–ê—ç—Ä–æ–ø–æ—Ä—Ç", "–®–∫–æ–ª–∞", "–¢–µ–∞—Ç—Ä", "–†—ã–Ω–æ–∫", "–ì–æ—Å—Ç–∏–Ω–∏—Ü–∞", "–ú–µ—Ç—Ä–æ", "–ë–æ–ª—å–Ω–∏—Ü–∞", "–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä", "–ü–∞—Ä–∫ –∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω–æ–≤", "–ú—É–∑–µ–π", "–°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è –∞—Ä–µ–Ω–∞", "–†–µ—Å—Ç–æ—Ä–∞–Ω", "–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç", "–§–µ—Ä–º–∞", "–¢–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä", "–í–æ–∫–∑–∞–ª", "–õ–æ–¥–∫–∞", "–í–æ–¥–æ–ø–∞–¥", "–°–∫–µ–π—Ç-–ø–∞—Ä–∫", "–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å", "–ì–∞–ª–µ—Ä–µ—è", "–ü—É—Å—Ç—ã–Ω—è", "–õ–µ–¥–Ω–∏–∫", "–ë–∞–ª–∫–æ–Ω", "–ì–∞—Ä–∞–∂", "–ö–Ω–∏–∂–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω", "–ü–ª–∞–Ω–µ—Ç–∞—Ä–∏–π", "–ö–æ—Ñ–µ–π–Ω—è", "–°—Ç–æ–ª–æ–≤–∞—è", "–ß–µ—Ä–¥–∞–∫", "–î–µ—Ç—Å–∫–∏–π —Å–∞–¥", "–ü–æ—Ä—Ç", "–í–∏–Ω–æ–¥–µ–ª—å–Ω—è", "–õ—É–≥", "–ö–∞–±–∏–Ω–µ—Ç", "–ê–∫–≤–∞—Ä–∏—É–º", "–ì–æ—Å—Ç–∏–Ω–∞—è", "–°—Ç–∞–¥–∏–æ–Ω", "–í–µ—á–µ—Ä–∏–Ω–∫–∞", "–õ–µ–¥–æ–≤–∞—è –∞—Ä–µ–Ω–∞", "–û—Ä–∞–Ω–∂–µ—Ä–µ—è", "–¢–µ—Ä—Ä–∞—Å–∞", "–ê–≤—Ç–æ–±—É—Å", "–ü–µ–∫–∞—Ä–Ω—è", "–ë–∞—Ä", "–ü–æ–µ–∑–¥", "–ù–æ—á–Ω–æ–π –∫–ª—É–±", "–ü–∞—Ä–∫", "–ñ–∏–ª–æ–π –¥–æ–º", "–ö–ª–∞–¥–æ–≤–∫–∞", "–°—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç", "–ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è", "–¢—Ä–∞–º–≤–∞–π", "–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è", "–ö–æ–Ω—Ü–µ—Ä—Ç–Ω—ã–π –∑–∞–ª", "–Ø—Ä–º–∞—Ä–∫–∞", "–ü–∏—Ä–∞—Ç—Å–∫–∏–π –∫–æ—Ä–∞–±–ª—å", "–¢—Ä–µ–Ω–∞–∂–µ—Ä–Ω—ã–π –∑–∞–ª", "–ü–æ–¥–≤–∞–ª", "–ö—É–∑–Ω–∏—Ü–∞", "–û—Ñ–∏—Å", "–ü–æ—á—Ç–∞", "–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞", "–ö–æ—Ç–µ–ª—å–Ω–∞—è", "–ò–≥—Ä–æ–≤–∞—è –∫–æ–º–Ω–∞—Ç–∞", "–ê–≤—Ç–æ–¥—Ä–æ–º"];
    const QUESTIONS = ["–ú–æ–∂–Ω–æ –ª–∏ –∑–¥–µ—Å—å –ª–µ—Ç–∞—Ç—å?", "–ó–¥–µ—Å—å –≥–æ—Ç–æ–≤—è—Ç –µ–¥—É?", "–°–ª—ã—à–Ω–æ –ª–∏ –º–Ω–æ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤?", "–ú–æ–∂–Ω–æ –ª–∏ –ø–ª–∞–≤–∞—Ç—å –∑–¥–µ—Å—å?", "–ù—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–∞—Å–ø–æ—Ä—Ç?", "–ï—Å—Ç—å –ª–∏ –∫–Ω–∏–≥–∏?", "–ú–æ–∂–Ω–æ –ª–∏ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è —Å–ø–æ—Ä—Ç–æ–º?", "–ï—Å—Ç—å –ª–∏ –∑–¥–µ—Å—å –ª–µ–∫–∞—Ä—Å—Ç–≤–∞?", "–ù—É–∂–Ω–æ –ª–∏ –±—Ä–∞—Ç—å –∫—É–ø–∞–ª—å–Ω–∏–∫?", "–°–æ–ª–Ω–µ—á–Ω–æ –ª–∏ –∑–¥–µ—Å—å?"];

    let state = { p: 0, spy: 0, word: "", cur: 0, t: null };

    document.getElementById('questions-list').innerHTML = QUESTIONS.map(q => `<div style="padding: 12px 0; border-bottom: 1px solid #222;">${q}</div>`).join('');

    function adjust(id, delta) {
        const input = document.getElementById(id);
        const display = document.getElementById(id + '-val');
        let val = parseInt(input.value) + delta;
        if (id === 'p-count' && val < 3) val = 3;
        if (id === 't-count' && val < 1) val = 1;
        input.value = val;
        display.innerText = val;
        if (window.navigator.vibrate) window.navigator.vibrate(10);
    }

    function startGame() {
        state.p = +document.getElementById('p-count').value;
        state.word = MY_LOCATIONS[Math.floor(Math.random() * MY_LOCATIONS.length)];
        state.spy = Math.floor(Math.random() * state.p);
        state.cur = 0;
        updateTimerText(+document.getElementById('t-count').value * 60);
        show('roles');
        updateCard();
    }

    function updateCard() {
        document.getElementById('player-indicator').innerText = `–ò–ì–†–û–ö ${state.cur + 1}`;
        document.getElementById('card').classList.remove('flipped');
        document.getElementById('next-btn').style.visibility = 'hidden';
        const isSpy = state.cur === state.spy;
        document.getElementById('role-main').innerText = isSpy ? "–®–ü–ò–û–ù" : state.word;
        document.getElementById('role-status').innerText = isSpy ? "–í–ù–ò–ú–ê–ù–ò–ï!" : "–í–ê–®–ê –õ–û–ö–ê–¶–ò–Ø:";
        document.getElementById('role-status').style.color = isSpy ? "#ff4d4d" : "#00ff88";
    }

    function flipCard() {
        document.getElementById('card').classList.add('flipped');
        document.getElementById('next-btn').style.visibility = 'visible';
    }

    function nextPlayer() {
        document.getElementById('next-btn').style.visibility = 'hidden';
        document.getElementById('card').classList.remove('flipped');
        setTimeout(() => {
            state.cur++;
            if (state.cur < state.p) updateCard();
            else runTimer();
        }, 300);
    }

    function updateTimerText(sec) {
        let abs = Math.abs(sec);
        document.getElementById('timer').innerText = `${String(Math.floor(abs/60)).padStart(2,'0')}:${String(abs%60).padStart(2,'0')}`;
        document.getElementById('timer').style.color = sec <= 0 ? 'var(--danger)' : 'var(--accent)';
    }

    function runTimer() {
        show('game');
        let sec = +document.getElementById('t-count').value * 60;
        if (state.t) clearInterval(state.t);
        state.t = setInterval(() => {
            sec--;
            updateTimerText(sec);
        }, 1000);
    }

    function toggleModal(id, val) { document.getElementById(id).classList.toggle('active', val); }

    function confirmReset() { toggleModal('confirm-modal', true); }

    function resetApp() {
        toggleModal('confirm-modal', false);
        clearInterval(state.t);
        show('setup');
    }

    function show(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
</script>
</body>
</html>
