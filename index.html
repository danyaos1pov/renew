<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SPYFALL MEGA PACK</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>

    <style>
        :root {
            --accent: #00f2ff;
            --bg: #0a0e14;
            --card-dark: #151a21;
            --glass: rgba(255, 255, 255, 0.05);
            --danger: #ff4d4d;
            --success: #00ff88;
        }

        * { 
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent; 
            font-family: 'Montserrat', sans-serif;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg);
            color: white;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            width: 100%;
        }

        .bg-glow {
            position: absolute;
            width: 250px; height: 250px;
            background: var(--accent); filter: blur(120px);
            opacity: 0.1; z-index: -1; top: 10%; left: 50%;
            transform: translate(-50%, -50%);
        }

        .wrapper {
            flex: 1;
            display: flex; flex-direction: column;
            padding: 15px; max-width: 650px; margin: 0 auto; width: 100%;
            height: 100%;
        }

        .screen { display: none; flex-direction: column; height: 100%; animation: fadeIn 0.2s ease-out; }
        .screen.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        h1 { font-weight: 900; font-size: 2.2rem; margin: 0; text-align: center;
        letter-spacing: -1px; }
        .tagline { color: var(--accent); font-size: 0.65rem; text-align: center; letter-spacing: 3px;
        margin-bottom: 25px; }

        .setting-box {
            background: var(--glass);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px; padding: 14px; margin-bottom: 12px;
            display: flex; justify-content: space-between; align-items: center;
        }

        .num-input {
            background: #000;
            border: 1px solid var(--accent); color: var(--accent);
            border-radius: 8px; padding: 8px; width: 60px; text-align: center;
            font-size: 1.1rem; font-weight: bold; outline: none;
        }

        .btn {
            background: white;
            color: black; border: none; padding: 18px;
            border-radius: 16px; font-weight: 900; text-transform: uppercase;
            font-size: 0.9rem; cursor: pointer; transition: 0.2s; width: 100%;
        }
        .btn:active { transform: scale(0.96); filter: brightness(0.9); }
        .btn-neon { background: var(--accent); box-shadow: 0 4px 15px rgba(0, 242, 255, 0.2);
        margin-top: auto; }
        
        .btn-danger-outline { 
            background: transparent;
            color: var(--danger);
            border: 1px solid rgba(255, 77, 77, 0.3);
            margin-top: 10px;
            padding: 12px;
        }

        #timer { font-size: 3.5rem; font-weight: 900; text-align: center; color: var(--accent);
        margin: 5px 0; }

        .hint-container {
            flex: 1;
            min-height: 0;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 5px;
        }

        .hint-container::-webkit-scrollbar { width: 4px; }
        .hint-container::-webkit-scrollbar-track { background: transparent; }
        .hint-container::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 10px; }

        .hint-list { 
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 8px;
        }

        .hint-item { 
            font-size: 0.7rem;
            color: #fff;
            padding: 10px 5px;
            background: linear-gradient(145deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 45px;
            cursor: pointer;
            line-height: 1.2;
        }

        .hint-item.crossed {
            opacity: 0.2;
            text-decoration: line-through;
            transform: scale(0.95);
            background: #000;
        }

        .modal {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.97); z-index: 100; padding: 20px;
            flex-direction: column; justify-content: center;
            align-items: center;
            backdrop-filter: blur(15px);
        }
        .modal.active { display: flex; }
        .modal-content {
            width: 100%;
            max-width: 500px; background: #0f1218; border: 1px solid var(--accent);
            border-radius: 24px; display: flex; flex-direction: column; max-height: 85vh;
            overflow: hidden;
        }

        .modal-body { 
            flex: 1;
            overflow-y: auto;
            padding: 10px 20px;
            scrollbar-width: thin;
            scrollbar-color: var(--accent) transparent;
        }

        .modal-body::-webkit-scrollbar { width: 6px; }
        .modal-body::-webkit-scrollbar-track { background: transparent; }
        .modal-body::-webkit-scrollbar-thumb { 
            background: var(--accent);
            border-radius: 10px;
            box-shadow: 0 0 10px var(--accent);
        }

        .q-item { padding: 14px 0;
        border-bottom: 1px solid rgba(255,255,255,0.05); color: #ccc; font-size: 0.85rem; }

        .switch { position: relative;
        display: inline-block; width: 44px; height: 24px; }
        .switch input { opacity: 0;
        width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0;
        left: 0; right: 0; bottom: 0; background-color: #333; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px;
        bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(20px); }

        .card-area { flex: 1; perspective: 1000px; margin: 20px 0; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s;
        transform-style: preserve-3d; }
        .card-inner.flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 24px;
        display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; border: 1px solid rgba(255,255,255,0.1); }
        .card-front { background: var(--card-dark); }
        .card-back { background: white; color: black; transform: rotateY(180deg); text-align: center; }

        #next-btn { transition: opacity 0.3s ease; }
        .btn-hidden { opacity: 0; pointer-events: none; }
    </style>
</head>
<body oncontextmenu="return false;">

<div class="bg-glow"></div>

<div class="wrapper">
    <div id="setup" class="screen active">
        <h1>SPYFALL</h1>
        <div class="tagline">ULTIMATE PACK</div>
        <div class="setting-box">
            <div><b>–ò–≥—Ä–æ–∫–æ–≤</b></div>
            <input type="number" id="p-count" class="num-input" value="4" min="3">
        </div>
        <div class="setting-box">
            <div><b>–¢–∞–π–º–µ—Ä (–º–∏–Ω)</b></div>
            <input type="number" id="t-count" class="num-input" value="5" min="1">
        </div>
        <div class="setting-box">
            <div><b>–°–ø–∏—Å–æ–∫ –ª–æ–∫–∞—Ü–∏–π</b></div>
            <label class="switch">
                <input type="checkbox" id="hints-toggle" checked>
                <span class="slider"></span>
            </label>
        </div>
        <button class="btn btn-neon" onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
    </div>

    <div id="roles" class="screen">
        <div id="player-indicator" style="text-align: center; font-weight: 900; color: var(--accent);">–ò–ì–†–û–ö 1</div>
        <div class="card-area">
            <div class="card-inner" id="card" onclick="flipCard()">
                <div class="card-face card-front">
                    <span style="font-size: 3.5rem;">üïµÔ∏è</span>
                    <p style="color: #444; font-size: 0.7rem; margin-top: 20px;">–ù–ê–ñ–ú–ò –î–õ–Ø –ü–†–û–°–ú–û–¢–†–ê</p>
                </div>
                <div class="card-face card-back">
                    <div id="role-status" style="font-size: 0.8rem; font-weight: bold; color: #777;">–¢–í–û–Ø –†–û–õ–¨:</div>
                    <div id="role-main" style="font-size: 1.8rem; font-weight: 900; margin-top: 10px; line-height: 1.1;">–õ–û–ö–ê–¶–ò–Ø</div>
                </div>
            </div>
        </div>
        <button class="btn btn-neon" id="next-btn" style="visibility: hidden;" onclick="nextPlayer()">–ü–†–ò–ù–Ø–¢–û</button>
    </div>

    <div id="game" class="screen">
        <div id="timer">00:00</div>
        <div class="hint-container">
            <div class="hint-list" id="hints"></div>
        </div>
        <button class="btn btn-neon" style="background: #1a1a1a; color: var(--accent); box-shadow: none;" onclick="toggleModal('q-modal', true)">–ò–¥–µ–∏ –≤–æ–ø—Ä–æ—Å–æ–≤</button>
        <button class="btn btn-danger-outline" onclick="confirmReset()">–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É</button>
    </div>
</div>

<div class="modal" id="q-modal">
    <div class="modal-content">
        <div class="modal-body" id="questions-list"></div>
        <div style="padding: 15px;"><button class="btn btn-neon" onclick="toggleModal('q-modal', false)">–ó–ê–ö–†–´–¢–¨</button></div>
    </div>
</div>

<div class="modal" id="confirm-modal">
    <div class="modal-content" style="text-align: center; padding: 25px;">
        <h2 style="margin-top: 0; color: var(--danger);">–í–´–•–û–î</h2>
        <p style="color: #ccc; margin-bottom: 25px;">–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ–∫—É—â—É—é –∏–≥—Ä—É?</p>
        <div style="display: flex; gap: 10px;">
            <button class="btn" style="background: #333; color: white;" onclick="toggleModal('confirm-modal', false)">–û–¢–ú–ï–ù–ê</button>
            <button class="btn" style="background: var(--danger); color: white;" onclick="resetApp()">–ó–ê–í–ï–†–®–ò–¢–¨</button>
        </div>
    </div>
</div>

<script>
    // 2. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø VK BRIDGE
    vkBridge.send("VKWebAppInit");

    const MY_LOCATIONS = ["–ü–ª—è–∂", "–õ–µ—Å", "–ö–∞—Ñ–µ", "–ó–æ–æ–ø–∞—Ä–∫", "–ê—ç—Ä–æ–ø–æ—Ä—Ç", "–®–∫–æ–ª–∞", "–¢–µ–∞—Ç—Ä", "–†—ã–Ω–æ–∫", "–ì–æ—Å—Ç–∏–Ω–∏—Ü–∞", "–ú–µ—Ç—Ä–æ", "–ë–æ–ª—å–Ω–∏—Ü–∞", "–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä", "–ü–∞—Ä–∫ –∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω–æ–≤", "–ú—É–∑–µ–π", "–°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è –∞—Ä–µ–Ω–∞", "–†–µ—Å—Ç–æ—Ä–∞–Ω", "–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç", "–§–µ—Ä–º–∞", "–¢–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä", "–í–æ–∫–∑–∞–ª", "–õ–æ–¥–∫–∞", "–í–æ–¥–æ–ø–∞–¥", "–°–∫–µ–π—Ç-–ø–∞—Ä–∫", "–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å", "–ì–∞–ª–µ—Ä–µ—è", "–ü—É—Å—Ç—ã–Ω—è", "–õ–µ–¥–Ω–∏–∫", "–ë–∞–ª–∫–æ–Ω", "–ì–∞—Ä–∞–∂", "–ö–Ω–∏–∂–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω", "–ü–ª–∞–Ω–µ—Ç–∞—Ä–∏–π", "–ö–æ—Ñ–µ–π–Ω—è", "–°—Ç–æ–ª–æ–≤–∞—è", "–ß–µ—Ä–¥–∞–∫", "–î–µ—Ç—Å–∫–∏–π —Å–∞–¥", "–ü–æ—Ä—Ç", "–í–∏–Ω–æ–¥–µ–ª—å–Ω—è", "–õ—É–≥", "–ö–∞–±–∏–Ω–µ—Ç", "–ê–∫–≤–∞—Ä–∏—É–º", "–ì–æ—Å—Ç–∏–Ω–∞—è", "–†–µ—Å—Ç–æ—Ä–∞–Ω –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –∫—É—Ö–Ω–∏", "–ö–∞—Ä—Ç–∏–Ω–Ω–∞—è –≥–∞–ª–µ—Ä–µ—è", "–°—Ç–∞–¥–∏–æ–Ω", "–õ–æ–¥–∂ –¥–ª—è –æ—Ç–¥—ã—Ö–∞", "–í–µ—á–µ—Ä–∏–Ω–∫–∞", "–õ–µ–¥–æ–≤–∞—è –∞—Ä–µ–Ω–∞", "–û—Ä–∞–Ω–∂–µ—Ä–µ—è", "–¢–µ—Ä—Ä–∞—Å–∞", "–ê–≤—Ç–æ–±—É—Å", "–ü–µ–∫–∞—Ä–Ω—è", "–í–µ–ª–æ—Å–∏–ø–µ–¥–Ω–∞—è –¥–æ—Ä–æ–∂–∫–∞", "–î–µ—Ç—Å–∫–∞—è –∫–æ–º–Ω–∞—Ç–∞", "–§—É—Ç–±–æ–ª—å–Ω–æ–µ –ø–æ–ª–µ", "–ë–∞—Ä", "–ü–æ–µ–∑–¥", "–ù–æ—á–Ω–æ–π –∫–ª—É–±", "–ü–∞—Ä–∫", "–ì–∞—Ä–∞–∂–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å", "–ñ–∏–ª–æ–π –¥–æ–º", "–õ–µ–¥—è–Ω–∞—è –ø–µ—â–µ—Ä–∞", "–°–∞–¥ –≤–æ –¥–≤–æ—Ä–µ", "–ö–ª–∞–¥–æ–≤–∫–∞", "–¢–∞–Ω—Ü–µ–≤–∞–ª—å–Ω–∞—è —Å—Ç—É–¥–∏—è", "–°—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç", "–ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è", "–†—ã–±–Ω–∞—è —Ñ–∞–±—Ä–∏–∫–∞", "–¢—Ä–∞–º–≤–∞–π", "–°–∞–¥–∏–∫", "–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è", "–ö–æ–Ω—Ü–µ—Ä—Ç–Ω—ã–π –∑–∞–ª", "–ü–ª–æ—â–∞–¥–∫–∞ –¥–ª—è –π–æ–≥–∏", "–ß–µ—Ä–¥–∞–∫ –¥–æ–º–∞", "–ê–≤—Ç–æ–∑–∞–ø—Ä–∞–≤–∫–∞", "–ú—É–∑—ã–∫–∞–ª—å–Ω–∞—è —à–∫–æ–ª–∞", "–õ–µ—Ç–Ω–∏–π –ª–∞–≥–µ—Ä—å", "–Ø—Ä–º–∞—Ä–∫–∞", "–ü–∞—Ä–∫ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π", "–í–µ–ª–æ—Å–∏–ø–µ–¥", "–§–æ—Ç–æ—Å—Ç—É–¥–∏—è", "–ü–∏—Ä–∞—Ç—Å–∫–∏–π –∫–æ—Ä–∞–±–ª—å", "–ì–∞—Ä–∞–∂ –¥–ª—è –º–∞—à–∏–Ω", "–î–µ—Ç—Å–∫–∏–π –ø–∞—Ä–∫", "–°—Ç–∞–Ω—Ü–∏—è –º–µ—Ç—Ä–æ", "–õ–µ–¥—è–Ω–æ–π —Ñ—å–æ—Ä–¥", "–°–∞–¥ —Å —Ñ–æ–Ω—Ç–∞–Ω–∞–º–∏", "–†—ã–±–æ–ª–æ–≤–Ω—ã–π –ø—Ä–∏—á–∞–ª", "–ö–ª—É–± –Ω–∞—Å—Ç–æ–ª—å–Ω—ã—Ö –∏–≥—Ä", "–°—Ç–∞–Ω—Ü–∏—è —ç–ª–µ–∫—Ç—Ä–∏—á–∫–∏", "–¢—Ä–µ–Ω–∞–∂–µ—Ä–Ω—ã–π –∑–∞–ª", "–ü–æ–¥–≤–∞–ª", "–ì–æ—Å—Ç–µ–≤–æ–π –¥–æ–º", "–ö—É–∑–Ω–∏—Ü–∞", "–ü–ª–æ—â–∞–¥–∫–∞ –¥–ª—è –±–∞—Å–∫–µ—Ç–±–æ–ª–∞", "–ü–∞—Ä–∫ –æ—Ç–¥—ã—Ö–∞", "–ü–∏–≤–æ–≤–∞—Ä–Ω—è", "–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª", "–ß–µ—Ä–¥–∞–∫ –∫–≤–∞—Ä—Ç–∏—Ä—ã", "–ö—É–ª–∏–Ω–∞—Ä–Ω–∞—è —à–∫–æ–ª–∞", "–¢–µ–∞—Ç—Ä–∞–ª—å–Ω–∞—è —Å—Ç—É–¥–∏—è", "–î–µ—Ä–µ–≤–µ–Ω—Å–∫–∞—è —Ñ–µ—Ä–º–∞", "–õ–µ—Ç–Ω—è—è —Ç–µ—Ä—Ä–∞—Å–∞", "–ì–æ—Ä–æ–¥—Å–∫–∞—è –ø–ª–æ—â–∞–¥—å", "–°—Ç—É–¥–∏—è –¥–∏–∑–∞–π–Ω–∞", "–ö–∏–Ω–æ—à–∫–æ–ª–∞", "–ö–∞–±–∏–Ω–µ—Ç –¥–æ–º–∞", "–ê–∫–≤–∞—Ä–∏—É–º —Å –º–æ—Ä—Å–∫–∏–º–∏ –∂–∏–≤–æ—Ç–Ω—ã–º–∏", "–û—Ñ–∏—Å", "–ü–µ—Å—á–∞–Ω—ã–π –ø–ª—è–∂", "–°–∫–≤–µ—Ä", "–î–µ—Ç—Å–∫–∏–π –ª–∞–≥–µ—Ä—å", "–í–µ–ª–æ—Å–∏–ø–µ–¥–Ω–∞—è –¥–æ—Ä–æ–∂–∫–∞ –≤ –ø–∞—Ä–∫–µ", "–ö–ª—É–± –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º", "–ì–æ—Ä–æ–¥—Å–∫–æ–π —Å–∞–¥", "–ü–æ—Ö–æ–¥–Ω–∞—è –±–∞–∑–∞", "–¢—Ä–æ–ø–∞ –≤ –ª–µ—Å—É", "–ö—É–∑–æ–≤–Ω–æ–π —Ü–µ—Ö", "–†—ã–±–∞—Ü–∫–∞—è –¥–µ—Ä–µ–≤–Ω—è", "–ú—É–∑–µ–π –Ω–∞—É–∫–∏", "–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∫", "–ü–ª–æ—â–∞–¥–∫–∞ –¥–ª—è –≤–æ–ª–µ–π–±–æ–ª–∞", "–ê–≤—Ç–æ—Å–∞–ª–æ–Ω", "–ë–∞–Ω–∫–æ–º–∞—Ç", "–†—ã–±–Ω—ã–π —Ä—ã–Ω–æ–∫", "–ü–∞—Ä–∫ –ø–æ–¥ –æ—Ç–∫—Ä—ã—Ç—ã–º –Ω–µ–±–æ–º", "–õ–µ–¥—è–Ω–∞—è –≥–æ—Ä–∞", "–ü–µ–∫–∞—Ä–Ω—è —Å –≤—ã–ø–µ—á–∫–æ–π", "–ö–∞–±–∏–Ω–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞", "–°–∞–¥ —Å –æ—Ä–∞–Ω–∂–µ—Ä–µ–µ–π", "–ü–ª–æ—â–∞–¥–∫–∞ –¥–ª—è —Å–∫–µ–π—Ç–±–æ—Ä–¥–∞", "–¢–∞–Ω—Ü–µ–≤–∞–ª—å–Ω–∞—è —à–∫–æ–ª–∞", "–°—Ç–∞–¥–∏–æ–Ω –¥–ª—è –ª–µ–≥–∫–æ–π –∞—Ç–ª–µ—Ç–∏–∫–∏", "–í–æ–¥–Ω–∞—è —Å—Ç–∞–Ω—Ü–∏—è", "–ü–æ—á—Ç–∞", "–ö–ª—É–± –¥–ª—è –¥–µ—Ç–µ–π", "–ê–≤—Ç–æ–±—É—Å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞", "–ü–ª–æ—â–∞–¥–∫–∞ –¥–ª—è —Ç–µ–Ω–Ω–∏—Å–∞", "–§–∞–±—Ä–∏–∫–∞ –∏–≥—Ä—É—à–µ–∫", "–†—ã–Ω–æ–∫ –æ–≤–æ—â–µ–π –∏ —Ñ—Ä—É–∫—Ç–æ–≤", "–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞", "–ì–æ—Å—Ç–∏–Ω–∏—Ü–∞ –¥–ª—è —Ç—É—Ä–∏—Å—Ç–æ–≤", "–í–µ–ª–æ–ø–∞—Ä–∫–æ–≤–∫–∞", "–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä –ø–æ–¥ –æ—Ç–∫—Ä—ã—Ç—ã–º –Ω–µ–±–æ–º", "–ö–æ—Ç–µ–ª—å–Ω–∞—è", "–ö–æ–Ω—Ü–µ—Ä—Ç–Ω–∞—è –ø–ª–æ—â–∞–¥–∫–∞", "–õ–µ—Ç–Ω–∏–π –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä", "–ü–ª–∞–Ω—Ç–∞—Ü–∏—è —Ñ—Ä—É–∫—Ç–æ–≤", "–†—ã–±–Ω—ã–π –ø—Ä–∏—á–∞–ª", "–ò–≥—Ä–æ–≤–∞—è –∫–æ–º–Ω–∞—Ç–∞", "–¢—Ä–µ–Ω–∞–∂–µ—Ä–Ω–∞—è –∑–æ–Ω–∞", "–°—Ü–µ–Ω–∏—á–µ—Å–∫–∞—è –ø–ª–æ—â–∞–¥–∫–∞", "–ö–∞—Ä—Ç–∏–Ω–Ω–∞—è –º–∞—Å—Ç–µ—Ä—Å–∫–∞—è", "–õ–µ—Ç–Ω–∏–π —Å–∞–¥", "–î–µ—Ç—Å–∫–∏–π –ø–∞—Ä–∫ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π", "–ê–≤—Ç–æ–¥—Ä–æ–º", "–†—ã–±–∞—Ü–∫–∏–π –¥–æ–º–∏–∫", "–ö–æ—Ñ–µ–π–Ω—è —Å —Ç–µ—Ä—Ä–∞—Å–æ–π", "–í–æ–¥–æ–ø–∞–¥ –≤ –≥–æ—Ä–∞—Ö", "–õ–µ—Å–Ω–æ–π –º–∞—Å—Å–∏–≤", "–û—Ä–∞–Ω–∂–µ—Ä–µ—è —Å —Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–º–∏ —Ä–∞—Å—Ç–µ–Ω–∏—è–º–∏", "–§–∞–±—Ä–∏–∫–∞ —à–æ–∫–æ–ª–∞–¥–∞", "–ü–ª—è–∂ —Å –ø–µ—Å–∫–æ–º", "–ö–∞–±–∏–Ω–µ—Ç —É—á–∏—Ç–µ–ª—è", "–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–∞—è –ø–ª–æ—â–∞–¥–∫–∞", "–°–∫–µ–π—Ç-–ø–∞—Ä–∫ —É —à–∫–æ–ª—ã", "–í–µ—á–µ—Ä–∏–Ω–∫–∞ –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–æ–∑–¥—É—Ö–µ", "–ì–æ—Ä–æ–¥—Å–∫–æ–π —Å–∞–¥ —Å —Ñ–æ–Ω—Ç–∞–Ω–Ω–æ–º", "–ê–∫–≤–∞—Ä–∏—É–º —Å –º–µ–¥—É–∑–∞–º–∏", "–°—Ç–∞–¥–∏–æ–Ω –¥–ª—è —Ñ—É—Ç–±–æ–ª–∞", "–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è —Ö–∏–º–∏–∏", "–¢–µ–∞—Ç—Ä –¥–ª—è –¥–µ—Ç–µ–π", "–ú—É–∑—ã–∫–∞–ª—å–Ω–∞—è —Å—Ç—É–¥–∏—è", "–í–µ–ª–æ–ø–∞—Ä–∫–æ–≤–∫–∞ —É –ø–∞—Ä–∫–∞", "–î–µ—Ç—Å–∫–∞—è –ø–ª–æ—â–∞–¥–∫–∞ –≤–æ –¥–≤–æ—Ä–µ", "–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö", "–§–µ—Ä–º–∞ —Å –∂–∏–≤–æ—Ç–Ω—ã–º–∏", "–†—ã–±–∞—Ü–∫–∞—è –ª–æ–¥–∫–∞", "–õ–µ—Ç–Ω–∏–π –∫–µ–º–ø–∏–Ω–≥", "–ê–≤—Ç–æ–±—É—Å–Ω—ã–π –ø–∞—Ä–∫", "–°–∫–≤–µ—Ä —Å —Å–∫–∞–º–µ–π–∫–∞–º–∏", "–ß–µ—Ä–¥–∞–∫ —à–∫–æ–ª—ã", "–ì–æ—Ä–æ–¥—Å–∫–æ–π —Ä—ã–Ω–æ–∫", "–õ–µ–¥—è–Ω–∞—è –ø–µ—â–µ—Ä–∞", "–°–∞–¥ —Å —Ä–æ–∑–∞–º–∏", "–ü–ª—è–∂ —Å –ø–∞–ª—å–º–∞–º–∏", "–¢—Ä–µ–Ω–∞–∂–µ—Ä–Ω—ã–π –∑–∞–ª –¥–æ–º–∞", "–ö–æ–Ω—Ü–µ—Ä—Ç–Ω—ã–π –ø–∞—Ä–∫", "–õ–µ—Å–Ω–∞—è —Ç—Ä–æ–ø–∞", "–§–∞–±—Ä–∏–∫–∞ –ø–∏—Ü—Ü—ã", "–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –æ—Ñ–∏—Å", "–ü–ª–æ—â–∞–¥–∫–∞ –¥–ª—è –∏–≥—Ä—ã –≤ —Ñ—É—Ç–±–æ–ª", "–ö–∞–±–∏–Ω–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ —à–∫–æ–ª—ã", "–†—ã–±–Ω–∞—è —Ñ–µ—Ä–º–∞", "–ú—É–∑—ã–∫–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥–∫–∞ –Ω–∞ —É–ª–∏—Ü–µ", "–ê–≤—Ç–æ–∑–∞–ø—Ä–∞–≤–∫–∞ –≤–æ–∑–ª–µ –¥–æ—Ä–æ–≥–∏", "–°–∫–µ–π—Ç-–ø–∞—Ä–∫ –Ω–∞ –ø–ª–æ—â–∞–¥–∏", "–ì–∞—Ä–∞–∂–Ω—ã–π –±–æ–∫—Å", "–î–µ—Ç—Å–∫–∞—è –∫–æ–º–Ω–∞—Ç–∞ –¥–æ–º–∞", "–ü–∞—Ä–∫ –¥–ª—è –ø—Ä–æ–≥—É–ª–æ–∫", "–õ–æ–¥–∫–∞ –Ω–∞ —Ä–µ–∫–µ"];
    const QUESTIONS = ["–ú–æ–∂–Ω–æ –ª–∏ –∑–¥–µ—Å—å –ª–µ—Ç–∞—Ç—å?", "–ó–¥–µ—Å—å –≥–æ—Ç–æ–≤—è—Ç –µ–¥—É?", "–°–ª—ã—à–Ω–æ –ª–∏ –º–Ω–æ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤?", "–ú–æ–∂–Ω–æ –ª–∏ –ø–ª–∞–≤–∞—Ç—å –∑–¥–µ—Å—å?", "–ù—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–∞—Å–ø–æ—Ä—Ç?", "–ï—Å—Ç—å –ª–∏ –∫–Ω–∏–≥–∏?", "–ú–æ–∂–Ω–æ –ª–∏ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è —Å–ø–æ—Ä—Ç–æ–º?", "–ú–æ–∂–Ω–æ –ª–∏ —Å—Ç—Ä–æ–∏—Ç—å —á—Ç–æ-—Ç–æ —Ä—É–∫–∞–º–∏?", "–ù—É–∂–Ω–æ –ª–∏ –∏–º–µ—Ç—å —É—á–µ–±–Ω–∏–∫–∏?", "–ï—Å—Ç—å –ª–∏ –∑–¥–µ—Å—å –ª–µ–∫–∞—Ä—Å—Ç–≤–∞?", "–ú–æ–∂–Ω–æ –ª–∏ –∑–¥–µ—Å—å –≤—Å—Ç—Ä–µ—á–∞—Ç—å –º–Ω–æ–≥–æ –ª—é–¥–µ–π?", "–ù—É–∂–Ω–æ –ª–∏ –±—Ä–∞—Ç—å –∫—É–ø–∞–ª—å–Ω–∏–∫?", "–ï—Å—Ç—å –ª–∏ —Å—Ç–æ–ª–∏–∫–∏?", "–ú–æ–∂–Ω–æ –ª–∏ –∑–¥–µ—Å—å —Ä–∏—Å–æ–≤–∞—Ç—å?", "–ú–æ–∂–Ω–æ –ª–∏ –∑–¥–µ—Å—å –¥–µ–ª–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏?", "–°–æ–ª–Ω–µ—á–Ω–æ –ª–∏ –∑–¥–µ—Å—å?", "–ï—Å—Ç—å –ª–∏ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç—ã?", "–ú–æ–∂–Ω–æ –ª–∏ —Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–∏–ª—å–º—ã?", "–ó–¥–µ—Å—å —É—á–∞—Ç –Ω–æ–≤–æ–º—É?", "–ú–æ–∂–Ω–æ –ª–∏ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–π—Ç–∏—Å—å?", "–ù—É–∂–Ω–æ –ª–∏ –Ω–æ—Å–∏—Ç—å —Ñ–æ—Ä–º—É?", "–ú–æ–∂–Ω–æ –ª–∏ –∑–¥–µ—Å—å —Å–ø–∞—Ç—å?", "–ú–æ–∂–Ω–æ –ª–∏ –∑–¥–µ—Å—å –ø–æ–∫—É–ø–∞—Ç—å?", "–°–ª—ã—à–Ω–æ –ª–∏ –º—É–∑—ã–∫—É?", "–ù—É–∂–Ω–æ –ª–∏ –±—Ä–∞—Ç—å —Å–ø–æ—Ä—Ç-–æ–¥–µ–∂–¥—É?", "–ó–¥–µ—Å—å –ø—Ä–æ–¥–∞—é—Ç –µ–¥—É –Ω–∞ –≤—ã–Ω–æ—Å?", "–ú–æ–∂–Ω–æ –ª–∏ –∑–¥–µ—Å—å –∫–∞—Ç–∞—Ç—å—Å—è –Ω–∞ –∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω–∞—Ö?", "–ù—É–∂–Ω–æ –ª–∏ –∂–¥–∞—Ç—å –æ—á–µ—Ä–µ–¥–∏?", "–ï—Å—Ç—å –ª–∏ –∫–∞—Å—Å—ã?", "–ú–æ–∂–Ω–æ –ª–∏ —Å–º–æ—Ç—Ä–µ—Ç—å —ç–∫—Å–ø–æ–Ω–∞—Ç—ã?", "–ó–¥–µ—Å—å –º–Ω–æ–≥–æ –∑–µ–ª–µ–Ω–∏?", "–ï—Å—Ç—å –ª–∏ —Å—Ü–µ–Ω–∞?", "–ù—É–∂–Ω–æ –ª–∏ –ø–æ–∫—É–ø–∞—Ç—å –±–∏–ª–µ—Ç—ã?", "–ú–æ–∂–Ω–æ –ª–∏ –∑–¥–µ—Å—å –∑–∞–≥–æ—Ä–∞—Ç—å?", "–ó–¥–µ—Å—å –ª–µ—á–∞—Ç –ª—é–¥–µ–π?", "–ú–æ–∂–Ω–æ –ª–∏ –∑–¥–µ—Å—å –∏–≥—Ä–∞—Ç—å –≤ –∏–≥—Ä—ã?", "–ù—É–∂–Ω–æ –ª–∏ –±—ã—Ç—å –≤ —Ç–∏—à–∏–Ω–µ?", "–ú–æ–∂–Ω–æ –ª–∏ –∑–¥–µ—Å—å –µ—Å—Ç—å –º–æ—Ä–æ–∂–µ–Ω–æ–µ?", "–ù—É–∂–Ω–æ –ª–∏ –ø—Ä–µ–¥—ä—è–≤–ª—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã?", "–ú–æ–∂–Ω–æ –ª–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞—Ç—å?", "–ó–¥–µ—Å—å –ø—Ä–æ–¥–∞—é—Ç —Å—É–≤–µ–Ω–∏—Ä—ã?", "–ú–æ–∂–Ω–æ –ª–∏ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å –∑–Ω–∞–º–µ–Ω–∏—Ç–æ—Å—Ç—å?", "–ó–¥–µ—Å—å —É—á–∞—Ç –¥–µ—Ç–µ–π?", "–ú–æ–∂–Ω–æ –ª–∏ –ø—Ä—ã–≥–∞—Ç—å –≤ –≤–æ–¥—É?", "–ï—Å—Ç—å –ª–∏ –∑–¥–µ—Å—å –∞–ø—Ç–µ—á–∫–∞?", "–ù—É–∂–Ω–æ –ª–∏ –ø–æ–∫—É–ø–∞—Ç—å –±–∏–ª–µ—Ç?", "–°–ª—ã—à–Ω–æ –ª–∏ –∑–¥–µ—Å—å –º–∞—à–∏–Ω—ã?", "–ï—Å—Ç—å –ª–∏ —Ç–µ–ª–µ–≤–∏–∑–æ—Ä—ã?", "–ï—Å—Ç—å –ª–∏ —É–∫–∞–∑–∞—Ç–µ–ª–∏?", "–ó–¥–µ—Å—å –ø—Ä–æ–¥–∞—é—Ç –æ–¥–µ–∂–¥—É?", "–ú–æ–∂–Ω–æ –ª–∏ –æ—Ç–¥—ã—Ö–∞—Ç—å –Ω–∞ —Å–∫–∞–º–µ–π–∫–∞—Ö?", "–ú–æ–∂–Ω–æ –ª–∏ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å –¥—Ä—É–∑–µ–π?", "–ï—Å—Ç—å –ª–∏ –∑–¥–µ—Å—å —Ñ–æ–Ω—Ç–∞–Ω—ã?", "–ú–æ–∂–Ω–æ –ª–∏ –±—Ä–∞—Ç—å –µ–¥—É —Ä—É–∫–∞–º–∏?", "–ï—Å—Ç—å –ª–∏ –º–µ—Å—Ç–∞ –¥–ª—è –ø–∏–∫–Ω–∏–∫–∞?", "–ù—É–∂–Ω–æ –ª–∏ –ø—Ä–∏–Ω–æ—Å–∏—Ç—å —Å–≤–æ–∏ –≤–µ—â–∏?", "–ó–¥–µ—Å—å –ª–µ—á–∞—Ç –∂–∏–≤–æ—Ç–Ω—ã—Ö?", "–ï—Å—Ç—å –ª–∏ –∑–¥–µ—Å—å –≤—ã—Å—Ç–∞–≤–∫–∏?", "–ú–æ–∂–Ω–æ –ª–∏ –∫–∞—Ç–∞—Ç—å—Å—è –Ω–∞ –ª–æ–¥–∫–∞—Ö?", "–ó–¥–µ—Å—å –º–Ω–æ–≥–æ –ª—é–¥–µ–π?", "–ï—Å—Ç—å –ª–∏ –∑–¥–µ—Å—å —Ç—Ä–µ–Ω–∞–∂–µ—Ä—ã?", "–ó–¥–µ—Å—å —É—á–∞—Ç –≤–∑—Ä–æ—Å–ª—ã—Ö?", "–ï—Å—Ç—å –ª–∏ –∑–¥–µ—Å—å –≤—Ä–∞—á–∏?", "–ú–æ–∂–Ω–æ –ª–∏ —Å—Ç—Ä–æ–∏—Ç—å –∑–∞–º–∫–∏ –∏–∑ –ø–µ—Å–∫–∞?", "–ù—É–∂–Ω–æ –ª–∏ –∏–º–µ—Ç—å –±–∏–ª–µ—Ç—ã?", "–ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Å–∏–¥–µ—Ç—å –Ω–∞ —Ç—Ä–∞–≤–µ?", "–ï—Å—Ç—å –ª–∏ –∑–¥–µ—Å—å –∫–∞–±–∏–Ω–µ—Ç—ã?", "–ó–¥–µ—Å—å –ø—Ä–æ–¥–∞—é—Ç —Å–ª–∞–¥–æ—Å—Ç–∏?", "–ú–æ–∂–Ω–æ –ª–∏ —É—á–∏—Ç—å—Å—è –Ω–æ–≤–æ–º—É?", "–ú–æ–∂–Ω–æ –ª–∏ –∫–æ—Ä–º–∏—Ç—å —Ä—ã–±?", "–ú–æ–∂–Ω–æ –ª–∏ –∑–¥–µ—Å—å –ø–∏—Ç—å –≤–æ–¥—É?", "–ï—Å—Ç—å –ª–∏ –∑–¥–µ—Å—å –∫–∞—Ñ–µ?", "–ú–æ–∂–Ω–æ –ª–∏ –ª–æ–≤–∏—Ç—å —Ä—ã–±—É?", "–ï—Å—Ç—å –ª–∏ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ –ø–ª–æ—â–∞–¥–∫–∏?", "–ú–æ–∂–Ω–æ –ª–∏ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –π–æ–≥–∏?", "–ï—Å—Ç—å –ª–∏ –∑–¥–µ—Å—å –¥–µ—Ç—Å–∫–∏–µ –ø–ª–æ—â–∞–¥–∫–∏?", "–ú–æ–∂–Ω–æ –ª–∏ –Ω–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –∂–∏–≤–æ—Ç–Ω—ã–º–∏?", "–ï—Å—Ç—å –ª–∏ –ø–∞—Ä–∫–æ–≤–∫–∞?", "–ú–æ–∂–Ω–æ –ª–∏ –ø–∏—Ç—å –∫–æ—Ñ–µ?"];
    
    let state = { p: 0, spy: 0, word: "", cur: 0, t: null };
    let sessionLocations = [];
    document.getElementById('questions-list').innerHTML = QUESTIONS.map(q => `<div class="q-item">${q}</div>`).join('');

    function startGame() {
        state.p = +document.getElementById('p-count').value;
        sessionLocations = [...MY_LOCATIONS].sort(() => Math.random() - 0.5).slice(0, 14);
        state.word = sessionLocations[Math.floor(Math.random() * sessionLocations.length)];
        state.spy = Math.floor(Math.random() * state.p);
        state.cur = 0;
        updateTimerText(+document.getElementById('t-count').value * 60);
        show('roles');
        updateCard();
    }

    function updateCard() {
        document.getElementById('player-indicator').innerText = `–ò–ì–†–û–ö ${state.cur + 1}`;
        document.getElementById('card').classList.remove('flipped');
        const btn = document.getElementById('next-btn');
        btn.classList.remove('btn-hidden');
        btn.style.visibility = 'hidden';
        const isSpy = state.cur === state.spy;
        document.getElementById('role-main').innerText = isSpy ? "–®–ü–ò–û–ù" : state.word;
        document.getElementById('role-status').innerText = isSpy ? "–í–ù–ò–ú–ê–ù–ò–ï!" : "–í–ê–®–ê –õ–û–ö–ê–¶–ò–Ø:";
        document.getElementById('role-status').style.color = isSpy ? "#ff4d4d" : "#00ff88";
    }

    function flipCard() {
        document.getElementById('card').classList.add('flipped');
        document.getElementById('next-btn').style.visibility = 'visible';
    }

    function nextPlayer() {
        const btn = document.getElementById('next-btn');
        btn.classList.add('btn-hidden');
        document.getElementById('card').classList.remove('flipped');
        setTimeout(() => {
            state.cur++;
            if (state.cur < state.p) updateCard();
            else runTimer();
        }, 300);
    }

    function updateTimerText(sec) {
        let abs = Math.abs(sec);
        document.getElementById('timer').innerText = `${String(Math.floor(abs/60)).padStart(2,'0')}:${String(abs%60).padStart(2,'0')}`;
        document.getElementById('timer').style.color = sec <= 0 ? 'var(--danger)' : 'var(--accent)';
    }

    function runTimer() {
        show('game');
        const h = document.getElementById('hints');
        if (document.getElementById('hints-toggle').checked) {
            h.parentElement.style.display = 'block';
            h.innerHTML = [...sessionLocations].sort((a,b) => a.localeCompare(b)).map(w => `
                <div class="hint-item" onclick="toggleLocation(this)">${w}</div>
            `).join('');
        } else h.parentElement.style.display = 'none';

        let sec = +document.getElementById('t-count').value * 60;
        if (state.t) clearInterval(state.t);
        state.t = setInterval(() => {
            sec--;
            updateTimerText(sec);
        }, 1000);
    }

    function toggleLocation(el) {
        el.classList.toggle('crossed');
        if (window.navigator.vibrate) window.navigator.vibrate(10);
    }

    function toggleModal(id, val) { document.getElementById(id).classList.toggle('active', val); }

    function confirmReset() { toggleModal('confirm-modal', true); }

    // 3. –ö–û–†–†–ï–ö–¢–ù–û–ï –ó–ê–ö–†–´–¢–ò–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
    function resetApp() {
        toggleModal('confirm-modal', false);
        clearInterval(state.t);
        show('setup');
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏–µ Mini App
        vkBridge.send("VKWebAppClose", {"status": "success"}); 
    }

    function show(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
</script>
</body>
</html>
